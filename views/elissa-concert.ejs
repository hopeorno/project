<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elissa Concert Booking - AlUla</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #1a1a1a;
            color: #fff;
        }

        /* Navigation Bar */
        .navbar {
            background: #3B2A24;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 24px;
            color: #d4af37;
        }

        .navbar nav a {
            color: white;
            margin-left: 25px;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }

        .navbar nav a:hover {
            color: #d4af37;
        }

        /* Hero Section */
        .hero-section {
            position: relative;
            width: 100%;
            height: 400px;
            background: url('https://s7g10.scene7.com/is/image/rcu/Elissa-Hero-mobile-752x936?$Responsive$') center / cover no-repeat;
        }

        .hero-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        /* Event Details Section */
        .event-details {
            max-width: 1200px;
            margin: -50px auto 0;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        .event-card-header {
            background: #2c2c2c;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .event-card-header h2 {
            font-size: 36px;
            color: #d4af37;
            margin-bottom: 20px;
        }

        .event-description {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 30px;
            font-size: 16px;
        }

        /* Event Info Icons */
        .event-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
        }

        .info-icon {
            font-size: 24px;
            color: #d4af37;
        }

        .info-content h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }

        .info-content p {
            font-size: 16px;
            color: #fff;
            font-weight: bold;
        }

        /* Seats Section */
        .seats-section {
            max-width: 1200px;
            margin: 50px auto;
            padding: 0 20px;
        }

        .seats-container {
            background: #2c2c2c;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .seats-container h3 {
            color: #d4af37;
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
        }

        .stage {
            background: linear-gradient(135deg, #3B2A24, #5a4437);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 40px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .seats-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 15px;
            margin: 30px 0;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .seat {
            aspect-ratio: 1;
            border: 3px solid #444;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            background: #1a1a1a;
            color: #fff;
        }

        .seat:hover:not(.booked) {
            transform: scale(1.15);
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .seat.selected {
            background: #d4af37;
            color: #000;
            border-color: #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.8);
        }

        .seat.booked {
            background: #666;
            cursor: not-allowed;
            opacity: 0.4;
            border-color: #555;
        }

        /* Legend */
        .seat-legend {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin-top: 40px;
            padding: 25px;
            background: #1a1a1a;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .legend-box {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            border: 3px solid #444;
        }

        .legend-box.available {
            background: #1a1a1a;
        }

        .legend-box.selected {
            background: #d4af37;
            border-color: #d4af37;
        }

        .legend-box.booked {
            background: #666;
            opacity: 0.4;
        }

        /* Booking Summary */
        .booking-summary {
            background: #2c2c2c;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .booking-summary h3 {
            color: #d4af37;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #444;
            color: #ccc;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            margin-top: 20px;
            border-top: 2px solid #d4af37;
            font-size: 24px;
            font-weight: bold;
            color: #d4af37;
        }

        /* Payment Form */
        .payment-section {
            background: #2c2c2c;
            border-radius: 15px;
            padding: 40px;
            display: none;
        }

        .payment-section.active {
            display: block;
        }

        .payment-section h3 {
            color: #d4af37;
            font-size: 28px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #d4af37;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #444;
            border-radius: 8px;
            font-size: 16px;
            background: #1a1a1a;
            color: #fff;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card-icons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .card-icon {
            font-size: 30px;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #d4af37;
            color: #000;
        }

        .btn-primary:hover:not(:disabled) {
            background: #b89f2d;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-primary:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-back {
            background: #3B2A24;
            color: #fff;
            margin-bottom: 20px;
        }

        .btn-back:hover {
            background: #5a4437;
        }

        /* Success Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #2c2c2c;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .modal-content h2 {
            color: #d4af37;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .modal-content p {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .success-icon {
            font-size: 80px;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .seats-grid {
                grid-template-columns: repeat(8, 1fr);
                gap: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .event-info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <!-- Navigation -->
    <div class="hero">
        <nav>
            <a href="/">Home</a>
            <a href="/about">About</a>
            <a href="booking">Booking</a>
            <a href="/login">Login</a>
            <a href="/contact">Contact</a>
        </nav>
        <h1>ALULA EVENTS</h1>
    </div>

    <!-- Hero Image -->
    <div class="hero-section"></div>

    <!-- Event Details -->
    <div class="event-details">
        <div class="event-card-header">
            <h2>üé§ Elissa Concert - AlUla</h2>
            <p class="event-description">
                Get ready for an exceptional evening with the queen of feelings, Elissa, in the heart of historic AlUla city. 
                An unforgettable musical experience combining authentic art and enchanting nature. 
                Book your seat now and be part of this special event under the starry sky of AlUla.
            </p>
            <button class="book-btn" onclick="window.location.href='/booking?event=elissa'">Book Now ‚Üí</button>
        </div>
        <!-- Event Info Icons -->
        <div class="event-info-grid">
            <div class="info-item">
                <div class="info-icon">üìÖ</div>
                <div class="info-content">
                    <h4>Date</h4>
                    <p>January 9, 2026</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">üïê</div>
                <div class="info-content">
                    <h4>Arrival Time</h4>
                    <p>8:00 PM</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">üé≠</div>
                <div class="info-content">
                    <h4>Event Type</h4>
                    <p>Concert</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">üìç</div>
                <div class="info-content">
                    <h4>Location</h4>
                    <p>Maraya - AlUla</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">üë§</div>
                <div class="info-content">
                    <h4>Age Requirement</h4>
                    <p>12 years and above</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">üëî</div>
                <div class="info-content">
                    <h4>Dress Code</h4>
                    <p>Formal Attire</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Seats Selection -->
    <div class="seats-section">
        <button class="btn btn-back" onclick="window.location.href='/'">‚Üê Back to Events</button>

        <div class="seats-container">
            <h3>Choose Your Seats</h3>
            
            <div class="stage">üé§ Stage</div>

            <div class="seats-grid" id="seatsGrid"></div>

            <div class="seat-legend">
                <div class="legend-item">
                    <div class="legend-box available"></div>
                    <span>Available</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box selected"></div>
                    <span>Selected</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box booked"></div>
                    <span>Booked</span>
                </div>
            </div>
        </div>

        <!-- Booking Summary -->
        <div class="booking-summary">
            <h3>Booking Summary</h3>
            <div class="summary-row">
                <span>Event:</span>
                <span>Elissa Concert</span>
            </div>
            <div class="summary-row">
                <span>Selected Seats:</span>
                <span id="selectedSeatsText">No seats selected</span>
            </div>
            <div class="summary-row">
                <span>Number of Seats:</span>
                <span id="seatCount">0</span>
            </div>
            <div class="summary-row">
                <span>Seat Price:</span>
                <span>350 SAR</span>
            </div>
            <div class="summary-total">
                <span>Total:</span>
                <span id="totalPrice">0 SAR</span>
            </div>
            <button class="btn btn-primary" id="proceedBtn" onclick="showPayment()" disabled>
                Proceed to Payment
            </button>
        </div>

        <!-- Payment Section -->
        <div class="payment-section" id="paymentSection">
            <h3>Payment Information</h3>
            
            <form id="paymentForm" onsubmit="processPayment(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="fullName" required placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="email" required placeholder="example@email.com">
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="phone" required placeholder="+966 5X XXX XXXX" pattern="[+0-9\s]+">
                </div>

                <div class="form-group">
                    <label>Card Number</label>
                    <input type="text" id="cardNumber" required placeholder="1234 5678 9012 3456" 
                           maxlength="19" pattern="[0-9\s]+" oninput="formatCardNumber(this)">
                    <div class="card-icons">
                        <span class="card-icon">üí≥</span>
                        <span class="card-icon">üè¶</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Expiry Date</label>
                        <input type="text" id="expiryDate" required placeholder="MM/YY" 
                               maxlength="5" pattern="[0-9/]+" oninput="formatExpiry(this)">
                    </div>
                    <div class="form-group">
                        <label>CVV</label>
                        <input type="text" id="cvv" required placeholder="123" 
                               maxlength="3" pattern="[0-9]+">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Confirm Payment</button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
           <div class="success-icon">‚úÖ</div>
            <h2>Booking Successful!</h2>
            <p>
                Thank you for booking your ticket for Elissa's concert in AlUla.<br>
                Booking details have been sent to your email.<br>
                Booking Number: <strong id="bookingNumber"></strong>
            </p>
            <button class="btn btn-primary" onclick="closeModal()">Okay</button>
        </div>
    </div>

    <script>
        // Retrieve booked seats from server
        let bookedSeats = [];
        let selectedSeats = [];
        const SEAT_PRICE = 350;

        // Fetch booked seats from server
        async function loadBookedSeats() {
            try {
                const response = await fetch('/api/booked-seats');
                bookedSeats = await response.json();
                generateSeats();
            } catch (error) {
                console.error('Error loading booked seats:', error);
                generateSeats();
            }
        }

        // Generate seats
        function generateSeats() {
            const grid = document.getElementById('seatsGrid');
            grid.innerHTML = '';

            for (let i = 1; i <= 80; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.textContent = i;
                seat.dataset.seatNumber = i;

                if (bookedSeats.includes(i)) {
                    seat.classList.add('booked');
                } else {
                    seat.onclick = () => toggleSeat(i, seat);
                }

                grid.appendChild(seat);
            }
        }

        // Toggle seat selection
        function toggleSeat(seatNum, seatElement) {
            const index = selectedSeats.indexOf(seatNum);

            if (index > -1) {
                selectedSeats.splice(index, 1);
                seatElement.classList.remove('selected');
            } else {
                selectedSeats.push(seatNum);
                seatElement.classList.add('selected');
            }

            updateSummary();
        }

        // Update summary
        function updateSummary() {
            const count = selectedSeats.length;
            const total = count * SEAT_PRICE;

            document.getElementById('seatCount').textContent = count;
            document.getElementById('totalPrice').textContent = total + ' SAR';
            
            if (count > 0) {
                document.getElementById('selectedSeatsText').textContent = selectedSeats.sort((a, b) => a - b).join(', ');
                document.getElementById('proceedBtn').disabled = false;
            } else {
                document.getElementById('selectedSeatsText').textContent = 'No seats selected';
                document.getElementById('proceedBtn').disabled = true;
            }
        }

        // Show payment section
        function showPayment() {
            document.getElementById('paymentSection').classList.add('active');
            document.getElementById('paymentSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Format card number
        function formatCardNumber(input) {
            let value = input.value.replace(/\s/g, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            input.value = formattedValue;
        }

        // Format expiry date
        function formatExpiry(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            input.value = value;
        }

        // Process payment
        async function processPayment(event) {
            event.preventDefault();

            // Validate data
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;

            // Validate card number length
            if (cardNumber.length !== 16) {
                alert('Card number must be 16 digits');
                return;
            }

            // Validate expiry date
            const [month, year] = expiryDate.split('/');
            if (!month || !year || parseInt(month) > 12 || parseInt(month) < 1) {
                alert('Invalid expiry date');
                return;
            }

            // Check if the card is expired
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear() % 100;
            const currentMonth = currentDate.getMonth() + 1;

            if (parseInt(year) < currentYear || (parseInt(year) === currentYear && parseInt(month) < currentMonth)) {
                alert('Card is expired');
                return;
            }

            // Validate CVV
            if (cvv.length !== 3) {
                alert('CVV must be 3 digits');
                return;
            }

            // Send booking data to server
            const bookingData = {
                event: 'Elissa Concert',
                seats: selectedSeats,
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                total: selectedSeats.length * SEAT_PRICE
            };

            try {
                const response = await fetch('/api/book', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (result.success) {
                    // Create booking number
                    const bookingNumber = 'ALU' + result.bookingId.toString().padStart(8, '0');
                    document.getElementById('bookingNumber').textContent = bookingNumber;

                    // Show success message
                    document.getElementById('successModal').classList.add('active');
                } else {
                    alert(result.message || 'Booking failed, please try again');
                    // Reload booked seats
                    await loadBookedSeats();
                }
            } catch (error) {
                console.error('Booking error:', error);
                alert('An error occurred during booking, please try again');
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('successModal').classList.remove('active');
            window.location.href = '/';
        }

        // Initialize page
        loadBookedSeats();
    </script>

</body>
</html>